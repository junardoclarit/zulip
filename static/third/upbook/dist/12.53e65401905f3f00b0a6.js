(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{dBb2:function(n,e,t){"use strict";t.r(e);var o=t("CcnG"),r=function(){return function(){}}(),a=t("ueff"),l=t("lOTE"),i=t("pMnS"),s=t("WmtN"),u=t("RChO"),c=t("hc6C"),d=t("nWrj"),p=t("x3ba"),m=t("dqnu"),v=t("GI4A"),f=t("1XyP"),h=t("zOaw"),g=t("WYqd"),b=t("EBed"),y=t("xDb2"),C=t("Ip0R"),S=t("gIcY"),I=t("OVOv"),w=function(){function n(n,e){this.bsModalRef=n,this.conversationsService=e,this.isPending=!1,this.errorMessage=void 0,this.newConversationForm=new S.k({phoneNumber:new S.i("",[S.B.required]),message:new S.i("",[S.B.required,I.a.noWhitespaceValidator])})}return n.prototype.send=function(){var n=this;this.newConversationForm.invalid||this.isPending||(this.errorMessage=void 0,this.isPending=!0,this.conversationsService.startConversation(this.newConversationForm.value).then(function(){n.isPending=!1,n.bsModalRef.hide()}).catch(function(e){n.errorMessage=e.error.message,n.isPending=!1}))},n.prototype.close=function(){this.bsModalRef.hide()},n.prototype.isInvalid=function(n){return this.newConversationForm.controls[n].invalid&&this.newConversationForm.controls[n].touched},n}(),_=t("jFtu"),M=t("26FU"),P=t("F/XL"),O=t("67Y/"),x=t("yGQT"),N=t("tg95"),R=function(){function n(n,e,t){this.apiService=n,this.realTimeService=e,this.store=t,this._filters=[],this._conversationsStream=new M.a([]),this._currentConversationStream=new M.a(null),this.subscriptions=[]}return n.prototype.unsubscribe=function(){for(var n=0;n<this.subscriptions.length;n++)this.subscriptions[n].unsubscribe();this.subscriptions=[]},Object.defineProperty(n.prototype,"conversations",{get:function(){return this._conversationsStream.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"conversationsSnapshot",{get:function(){return this._conversationsStream.getValue()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filters",{get:function(){return Object(P.a)(this._filters)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentConversation",{get:function(){return this._currentConversationStream.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentConversationSnapshot",{get:function(){return this._currentConversationStream.getValue()},enumerable:!0,configurable:!0}),n.prototype.setFilter=function(n,e){var t=this._filters.findIndex(function(e){return e.name===n});-1===t?this._filters.push({name:n,value:e}):this._filters[t].value=e,this.loadConversations()},n.prototype.loadConversations=function(){var n=this;this.unsubscribe();var e=sessionStorage.getItem("upbookClientCompanyId");this.apiService.get("Conversation/"+e).subscribe(function(e){n._conversationsStream.next(e)}),this.realTimeService.connect();var t=this.realTimeService.conversationsStream.subscribe(function(e){n.store.pipe(Object(x.z)(N.a)).subscribe(function(t){var o=n.conversationsSnapshot;o.unshift({conversationId:e.conversationId,phoneNumber:e.payload.phoneNumber,messagePreview:e.payload.messagePreview,contact:e.payload.contact,lastUpdate:e.payload.lastUpdate,answeredBy:e.payload.answeredBy}),t.id!==e.userId&&(null==o[0].unread?o[0].unread=1:o[0].unread++),n._conversationsStream.next(o)})});this.subscriptions.push(t);var o=this.realTimeService.messagesStream.subscribe(function(e){var t=n._conversationsStream.getValue(),o=t.findIndex(function(n){return n.conversationId===e.conversationId});if(-1!==o){var r=t[o];r.messagePreview=e.payload.message,r.lastUpdate=e.payload.created,r.answeredBy="in"===e.direction?"":e.payload.userFullName,null!=n.currentConversationSnapshot&&n.currentConversationSnapshot.conversationId===e.conversationId||(null==r.unread?r.unread=1:r.unread++),n.moveElement(t,o,0),n._conversationsStream.next(t)}});this.subscriptions.push(o)},n.prototype.chatAvailable=function(){return n=this,void 0,t=function(){var n;return function(n,e){var t,o,r,a,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return l.label++,{value:a[1],done:!1};case 5:l.label++,o=a[1],a=[0];continue;case 7:a=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){l=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){l.label=a[1];break}if(6===a[0]&&l.label<r[1]){l.label=r[1],r=a;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(a);break}r[2]&&l.ops.pop(),l.trys.pop();continue}a=e.call(n,l)}catch(i){a=[6,i],o=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}(this,function(e){return(n=sessionStorage.getItem("upbookClientCompanyId"))?[2,this.apiService.get("Conversation/Available/"+n).toPromise()]:[2,Promise.resolve({success:!1})]})},new((e=void 0)||(e=Promise))(function(o,r){function a(n){try{i(t.next(n))}catch(e){r(e)}}function l(n){try{i(t.throw(n))}catch(e){r(e)}}function i(n){n.done?o(n.value):new e(function(e){e(n.value)}).then(a,l)}i((t=t.apply(n,[])).next())});var n,e,t},n.prototype.setCurrentConversation=function(n){this._currentConversationStream.next(null),this._currentConversationStream.next(n)},n.prototype.startConversation=function(n){var e=sessionStorage.getItem("upbookClientCompanyId");return this.apiService.post("Conversation/"+e,n).pipe(Object(O.a)(function(n){return n.conversationId})).toPromise()},n.prototype.zeroUnreadMessages=function(n){var e=this.conversationsSnapshot,t=e.findIndex(function(e){return e.conversationId===n.conversationId});-1!==t&&(e[t].unread=0),this._conversationsStream.next(e)},n.prototype.moveElement=function(n,e,t){if(t>=n.length)for(var o=t-n.length+1;o--;)n.push(void 0);return n.splice(t,0,n.splice(e,1)[0]),n},n}(),j=o["\u0275crt"]({encapsulation:0,styles:[["form[_ngcontent-%COMP%]{font-size:1.1rem}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{margin:10px 0}button[_ngcontent-%COMP%]:focus, input[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:0}textarea[_ngcontent-%COMP%]{resize:none}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;border:1px solid #e2e2e2;border-radius:4px;padding:10px}.modal-header[_ngcontent-%COMP%]{align-items:center}.close-button[_ngcontent-%COMP%]{background-color:transparent;border:none;padding:0;margin:0;cursor:pointer}.close-button[_ngcontent-%COMP%]:disabled, button[disabled][_ngcontent-%COMP%]{cursor:default}"]],data:{}});function k(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,1,"div",[["class","alert alert-danger"],["role","alert"]],null,null,null,null,null)),(n()(),o["\u0275ted"](1,null,["",""]))],null,function(n,e){n(e,1,0,e.component.errorMessage)})}function F(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,1,"div",[],null,null,null,null,null)),(n()(),o["\u0275ted"](-1,null,["Phone number is required"]))],null,null)}function T(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,2,"div",[["class","invalid-feedback d-block mb-2 ml-1"]],null,null,null,null,null)),(n()(),o["\u0275and"](16777216,null,null,1,null,F)),o["\u0275did"](2,16384,null,0,C.NgIf,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null)],function(n,e){n(e,2,0,e.component.newConversationForm.controls.phoneNumber.hasError("required"))},null)}function A(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,1,"div",[["class","invalid-feedback d-block ml-1"]],null,null,null,null,null)),(n()(),o["\u0275ted"](-1,null,["Message text is required"]))],null,null)}function E(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,4,"div",[["class","modal-header"]],null,null,null,null,null)),(n()(),o["\u0275eld"](1,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(n()(),o["\u0275ted"](-1,null,["New Conversation"])),(n()(),o["\u0275eld"](3,0,null,null,1,"button",[["class","close-button"],["type","button"]],null,[[null,"click"]],function(n,e,t){var o=!0;return"click"===e&&(o=!1!==n.component.close()&&o),o},null,null)),(n()(),o["\u0275eld"](4,0,null,null,0,"img",[["alt","\u274c"],["aria-hidden","true"],["src","/static/third/upbook/dist/assets/images/close_button.svg"]],null,null,null,null,null)),(n()(),o["\u0275eld"](5,0,null,null,23,"div",[["class","modal-body"]],null,null,null,null,null)),(n()(),o["\u0275and"](16777216,null,null,1,null,k)),o["\u0275did"](7,16384,null,0,C.NgIf,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),o["\u0275eld"](8,0,null,null,20,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],function(n,e,t){var r=!0;return"submit"===e&&(r=!1!==o["\u0275nov"](n,10).onSubmit(t)&&r),"reset"===e&&(r=!1!==o["\u0275nov"](n,10).onReset()&&r),r},null,null)),o["\u0275did"](9,16384,null,0,S.E,[],null,null),o["\u0275did"](10,540672,null,0,S.l,[[8,null],[8,null]],{form:[0,"form"]},null),o["\u0275prd"](2048,null,S.e,null,[S.l]),o["\u0275did"](12,16384,null,0,S.t,[[4,S.e]],null,null),(n()(),o["\u0275eld"](13,0,null,null,5,"input",[["formControlName","phoneNumber"],["name","phoneNumber"],["placeholder","Phone number"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(n,e,t){var r=!0;return"input"===e&&(r=!1!==o["\u0275nov"](n,14)._handleInput(t.target.value)&&r),"blur"===e&&(r=!1!==o["\u0275nov"](n,14).onTouched()&&r),"compositionstart"===e&&(r=!1!==o["\u0275nov"](n,14)._compositionStart()&&r),"compositionend"===e&&(r=!1!==o["\u0275nov"](n,14)._compositionEnd(t.target.value)&&r),r},null,null)),o["\u0275did"](14,16384,null,0,S.f,[o.Renderer2,o.ElementRef,[2,S.b]],null,null),o["\u0275prd"](1024,null,S.q,function(n){return[n]},[S.f]),o["\u0275did"](16,671744,null,0,S.j,[[3,S.e],[8,null],[8,null],[6,S.q],[2,S.G]],{name:[0,"name"]},null),o["\u0275prd"](2048,null,S.r,null,[S.j]),o["\u0275did"](18,16384,null,0,S.s,[[4,S.r]],null,null),(n()(),o["\u0275and"](16777216,null,null,1,null,T)),o["\u0275did"](20,16384,null,0,C.NgIf,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),o["\u0275eld"](21,0,null,null,5,"textarea",[["cols","30"],["formControlName","message"],["name","message"],["placeholder","Type message"],["rows","3"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(n,e,t){var r=!0;return"input"===e&&(r=!1!==o["\u0275nov"](n,22)._handleInput(t.target.value)&&r),"blur"===e&&(r=!1!==o["\u0275nov"](n,22).onTouched()&&r),"compositionstart"===e&&(r=!1!==o["\u0275nov"](n,22)._compositionStart()&&r),"compositionend"===e&&(r=!1!==o["\u0275nov"](n,22)._compositionEnd(t.target.value)&&r),r},null,null)),o["\u0275did"](22,16384,null,0,S.f,[o.Renderer2,o.ElementRef,[2,S.b]],null,null),o["\u0275prd"](1024,null,S.q,function(n){return[n]},[S.f]),o["\u0275did"](24,671744,null,0,S.j,[[3,S.e],[8,null],[8,null],[6,S.q],[2,S.G]],{name:[0,"name"]},null),o["\u0275prd"](2048,null,S.r,null,[S.j]),o["\u0275did"](26,16384,null,0,S.s,[[4,S.r]],null,null),(n()(),o["\u0275and"](16777216,null,null,1,null,A)),o["\u0275did"](28,16384,null,0,C.NgIf,[o.ViewContainerRef,o.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),o["\u0275eld"](29,0,null,null,3,"div",[["class","modal-footer text-right"]],null,null,null,null,null)),(n()(),o["\u0275eld"](30,0,null,null,2,"button",[["class","btn btn-primary"],["type","button"]],[[8,"disabled",0]],[[null,"click"]],function(n,e,t){var o=!0;return"click"===e&&(o=!1!==n.component.send()&&o),o},null,null)),(n()(),o["\u0275eld"](31,0,null,null,0,"i",[["class","fa fa-spinner fa-spin mr-2"]],[[8,"hidden",0]],null,null,null,null)),(n()(),o["\u0275ted"](-1,null,[" Send "]))],function(n,e){var t=e.component;n(e,7,0,t.errorMessage),n(e,10,0,t.newConversationForm),n(e,16,0,"phoneNumber"),n(e,20,0,t.isInvalid("phoneNumber")),n(e,24,0,"message"),n(e,28,0,t.isInvalid("message"))},function(n,e){var t=e.component;n(e,8,0,o["\u0275nov"](e,12).ngClassUntouched,o["\u0275nov"](e,12).ngClassTouched,o["\u0275nov"](e,12).ngClassPristine,o["\u0275nov"](e,12).ngClassDirty,o["\u0275nov"](e,12).ngClassValid,o["\u0275nov"](e,12).ngClassInvalid,o["\u0275nov"](e,12).ngClassPending),n(e,13,0,o["\u0275nov"](e,18).ngClassUntouched,o["\u0275nov"](e,18).ngClassTouched,o["\u0275nov"](e,18).ngClassPristine,o["\u0275nov"](e,18).ngClassDirty,o["\u0275nov"](e,18).ngClassValid,o["\u0275nov"](e,18).ngClassInvalid,o["\u0275nov"](e,18).ngClassPending),n(e,21,0,o["\u0275nov"](e,26).ngClassUntouched,o["\u0275nov"](e,26).ngClassTouched,o["\u0275nov"](e,26).ngClassPristine,o["\u0275nov"](e,26).ngClassDirty,o["\u0275nov"](e,26).ngClassValid,o["\u0275nov"](e,26).ngClassInvalid,o["\u0275nov"](e,26).ngClassPending),n(e,30,0,t.newConversationForm.invalid||t.isPending),n(e,31,0,!t.isPending)})}function L(n){return o["\u0275vid"](0,[(n()(),o["\u0275eld"](0,0,null,null,1,"ng-component",[],null,null,null,E,j)),o["\u0275did"](1,49152,null,0,w,[_.a,R],null,null)],null,null)}var V=o["\u0275ccf"]("ng-component",w,L,{},{isPending:"isPending"},[]),U=t("t/Na"),q=t("RH/Y"),B=t("jL7Y"),D=t("RUUI"),X=t("Ajfm"),G=t("ZYCi"),z=t("X32H"),H=t("SZbH"),W=t("lYi1"),Y=t("Wn1d"),Z=t("jfHL"),J=t("Mt9g"),K=t("60/5"),Q=t("1Mnl"),$=t("UepX"),nn=t("B9TK"),en=t("nqMs"),tn=t("secw"),on=t("xQLJ"),rn=t("1rfl"),an=t("S7LP"),ln=t("6aHO"),sn=t("008C"),un=t("b6SE"),cn=t("d62N"),dn=t("T7CS"),pn=t("WVoM"),mn=t("Pi2X"),vn=t("p2+w"),fn=t("mpiD"),hn=t("WoVx"),gn=t("7faX"),bn=t("7jUm"),yn=t("e4Nc"),Cn=t("AytR").a.CONVERSATION_BASE_URL,Sn=function(){function n(n){this.http=n}return n.prototype.get=function(n){return this.http.get(Cn+"/"+n)},n.prototype.post=function(n,e){return this.http.post(Cn+"/"+n,e)},n.prototype.file=function(n){return this.http.get(Cn+"/"+n,{responseType:"blob",observe:"body"})},n}(),In=t("VnD/"),wn=function(){function n(){}return n.prototype.connect=function(){},Object.defineProperty(n.prototype,"messagesStream",{get:function(){return this._eventsStream.pipe(Object(In.a)(function(n){return null!=n.type&&"message"===n.type}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"conversationsStream",{get:function(){return this._eventsStream.pipe(Object(In.a)(function(n){return null!=n.type&&"conversation"===n.type}))},enumerable:!0,configurable:!0}),n}(),_n=function(){function n(n,e,t){var o=this;this.conversationService=n,this.apiService=e,this._userAttachmentsStream=new M.a([]),this.renderer=t.createRenderer(null,null),this.conversationService.currentConversation.subscribe(function(n){null===n?o._userAttachmentsStream.next([]):null!=n.contact&&o.apiService.get("Contact/Attachment/"+n.contact.contactId).subscribe(function(n){o._userAttachmentsStream.next(n)})})}return Object.defineProperty(n.prototype,"userAttachments",{get:function(){return this._userAttachmentsStream.asObservable()},enumerable:!0,configurable:!0}),n.prototype.addAttachment=function(n){var e=this;return this.storeAttachment(n).then(function(n){var t=e._userAttachmentsStream.getValue();return t.push(n),e._userAttachmentsStream.next(t),!0})},n.prototype.storeAttachment=function(n){return this.apiService.post("Contact/Attachment/"+this.conversationService.currentConversationSnapshot.contact.contactId,n).toPromise()},n.prototype.downloadAttachment=function(n){var e=this;this.apiService.file("Contact/Attachment/Download/"+n.attachmentId).toPromise().then(function(t){var o=window.URL.createObjectURL(t),r=e.renderer.createElement("a");e.renderer.appendChild(document.body,r),e.renderer.setStyle(r,"display","none"),e.renderer.setAttribute(r,"href",o),e.renderer.setAttribute(r,"download",n.fileName),r.click(),window.URL.revokeObjectURL(o),e.renderer.removeChild(document.body,r)})},n}(),Mn=function(){function n(n,e){var t=this;this.conversationService=n,this.apiService=e,this._userNotesStream=new M.a([]),this.conversationService.currentConversation.subscribe(function(n){null===n?t._userNotesStream.next([]):null!=n.contact&&t.apiService.get("Contact/Note/"+n.contact.contactId).subscribe(function(n){t._userNotesStream.next(n)})})}return Object.defineProperty(n.prototype,"userNotes",{get:function(){return this._userNotesStream.asObservable()},enumerable:!0,configurable:!0}),n.prototype.createNote=function(n){return e=this,void 0,o=function(){var e=this;return function(n,e){var t,o,r,a,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return l.label++,{value:a[1],done:!1};case 5:l.label++,o=a[1],a=[0];continue;case 7:a=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){l=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){l.label=a[1];break}if(6===a[0]&&l.label<r[1]){l.label=r[1],r=a;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(a);break}r[2]&&l.ops.pop(),l.trys.pop();continue}a=e.call(n,l)}catch(i){a=[6,i],o=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}(this,function(t){return[2,this.storeContactNote(n).then(function(t){return t&&e._userNotesStream.getValue().push({noteId:t,note:n}),!!t})]})},new((t=void 0)||(t=Promise))(function(n,r){function a(n){try{i(o.next(n))}catch(e){r(e)}}function l(n){try{i(o.throw(n))}catch(e){r(e)}}function i(e){e.done?n(e.value):new t(function(n){n(e.value)}).then(a,l)}i((o=o.apply(e,[])).next())});var e,t,o},n.prototype.storeContactNote=function(n){return this.apiService.post("Contact/Note",{contactId:this.conversationService.currentConversationSnapshot.contact.contactId,note:n}).pipe(Object(O.a)(function(n){return n.noteId})).toPromise()},n}(),Pn=t("MQIr"),On=t("xMyE"),xn=function(){function n(n,e,t){this.apiService=n,this.conversationService=e,this.realTimeService=t,this.page=0,this.allMessagesLoaded=!1,this.subscriptions=[]}return n.prototype.unsubscribe=function(){for(var n=0;n<this.subscriptions.length;n++)this.subscriptions[n].unsubscribe();this.subscriptions=[]},n.prototype.LoadMessages=function(){var n=this;this.unsubscribe(),this._conversationMessagesStream=new M.a([]);var e=this.conversationService.currentConversation.subscribe(function(e){null===e?(n._conversationMessagesStream.next([]),n.page=0,n.allMessagesLoaded=!1):n.apiService.get("Message/"+e.conversationId+"?page="+n.page).subscribe(function(e){e.length<10&&(n.allMessagesLoaded=!0),n._conversationMessagesStream.next(e)})});this.subscriptions.push(e);var t=this.realTimeService.messagesStream.pipe(Object(In.a)(function(e){var t=n.conversationService.currentConversationSnapshot;return null!==t&&t.conversationId===e.conversationId})).subscribe(function(e){var t=n._conversationMessagesStream.getValue();t.push({direction:e.direction,message:e.payload.message,userFullName:e.payload.userFullName,messageId:e.payload.messageId,created:e.payload.created}),n._conversationMessagesStream.next(t),n.markMessageAsRead(e.payload.messageId)});this.subscriptions.push(t)},Object.defineProperty(n.prototype,"currentConversationMessages",{get:function(){return this._conversationMessagesStream.asObservable().pipe(Object(On.a)(function(n){n.sort(function(n,e){return n.messageId<e.messageId?-1:1})}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentConversationMessagesSnapshot",{get:function(){return this._conversationMessagesStream.getValue()},enumerable:!0,configurable:!0}),n.prototype.loadPreviousMessages=function(){var n=this;if(!this.allMessagesLoaded){var e=this.conversationService.currentConversationSnapshot;this.page++,this.apiService.get("Message/"+e.conversationId+"?page="+this.page).subscribe(function(e){e.length<10&&(n.allMessagesLoaded=!0),n._conversationMessagesStream.next(e.concat(n.currentConversationMessagesSnapshot))})}},n.prototype.sendMessage=function(n){return this.apiService.post("Message",{conversationId:this.conversationService.currentConversationSnapshot.conversationId,message:n}).pipe(Object(O.a)(function(n){return!!n.messageId})).toPromise()},n.prototype.markMessageAsRead=function(n){return this.apiService.post("Message/Read",{messageId:n}).pipe(Object(O.a)(function(n){return n.success})).toPromise()},n}(),Nn=t("Fq6B"),Rn=t("h5ll"),jn=(t("mrSG"),function(){return function(){}}()),kn=function(){return function(){}}(),Fn=t("5KXc"),Tn=t("qina"),An=t("F+oH"),En=t("Jg5P"),Ln=t("aZVl"),Vn=t("9VEM"),Un=t("bnTs"),qn=t("H5g1"),Bn=t("dU8u"),Dn=t("sU9O"),Xn=t("PCNd");t.d(e,"ConversationsModuleNgFactory",function(){return Gn});var Gn=o["\u0275cmf"](r,[],function(n){return o["\u0275mod"]([o["\u0275mpd"](512,o.ComponentFactoryResolver,o["\u0275CodegenComponentFactoryResolver"],[[8,[a.a,l.a,i.a,s.a,u.a,c.a,d.a,p.a,m.a,v.a,f.a,h.a,g.a,b.a,y.a,V]],[3,o.ComponentFactoryResolver],o.NgModuleRef]),o["\u0275mpd"](4608,C.NgLocalization,C.NgLocaleLocalization,[o.LOCALE_ID,[2,C["\u0275angular_packages_common_common_a"]]]),o["\u0275mpd"](4608,S.F,S.F,[]),o["\u0275mpd"](4608,S.h,S.h,[]),o["\u0275mpd"](4608,U.j,U.p,[C.DOCUMENT,o.PLATFORM_ID,U.n]),o["\u0275mpd"](4608,U.q,U.q,[U.j,U.o]),o["\u0275mpd"](5120,U.a,function(n,e,t,o,r,a){return[n,new q.a,new B.a(e,t,o),new D.a(r),new X.a(a)]},[U.q,G.l,z.a,H.j,W.a,G.l]),o["\u0275mpd"](4608,U.m,U.m,[]),o["\u0275mpd"](6144,U.k,null,[U.m]),o["\u0275mpd"](4608,U.i,U.i,[U.k]),o["\u0275mpd"](6144,U.b,null,[U.i]),o["\u0275mpd"](4608,U.f,U.l,[U.b,o.Injector]),o["\u0275mpd"](4608,U.c,U.c,[U.f]),o["\u0275mpd"](4608,Y.a,Y.a,[U.c,x.l]),o["\u0275mpd"](4608,Z.a,Z.a,[U.c]),o["\u0275mpd"](4608,J.a,J.a,[U.c]),o["\u0275mpd"](4608,K.a,K.a,[U.c]),o["\u0275mpd"](4608,Q.a,Q.a,[U.c]),o["\u0275mpd"](4608,$.a,$.a,[U.c]),o["\u0275mpd"](4608,nn.a,nn.a,[U.c]),o["\u0275mpd"](4608,en.a,en.a,[U.c]),o["\u0275mpd"](4608,tn.a,tn.a,[U.c]),o["\u0275mpd"](4608,on.b,on.b,[o.NgZone]),o["\u0275mpd"](4608,rn.a,rn.a,[]),o["\u0275mpd"](4608,an.a,an.a,[]),o["\u0275mpd"](4608,ln.a,ln.a,[o.ComponentFactoryResolver,o.NgZone,o.Injector,an.a,o.ApplicationRef]),o["\u0275mpd"](4608,sn.a,sn.a,[o.RendererFactory2,ln.a]),o["\u0275mpd"](4608,un.a,un.a,[sn.a]),o["\u0275mpd"](4608,cn.b,cn.b,[]),o["\u0275mpd"](4608,dn.a,dn.a,[]),o["\u0275mpd"](4608,pn.a,pn.a,[]),o["\u0275mpd"](4608,mn.a,mn.a,[]),o["\u0275mpd"](4608,vn.a,vn.a,[]),o["\u0275mpd"](4608,fn.a,fn.a,[]),o["\u0275mpd"](4608,I.a,I.a,[]),o["\u0275mpd"](4608,hn.a,hn.a,[z.a,Z.a]),o["\u0275mpd"](4608,gn.a,gn.a,[x.l]),o["\u0275mpd"](4608,bn.a,bn.a,[x.l,G.l]),o["\u0275mpd"](4608,yn.a,yn.a,[]),o["\u0275mpd"](4608,Sn,Sn,[U.c]),o["\u0275mpd"](4608,wn,wn,[]),o["\u0275mpd"](4608,R,R,[Sn,wn,x.l]),o["\u0275mpd"](4608,_n,_n,[R,Sn,o.RendererFactory2]),o["\u0275mpd"](4608,Mn,Mn,[R,Sn]),o["\u0275mpd"](4608,Pn.a,Pn.a,[Sn]),o["\u0275mpd"](4608,xn,xn,[Sn,R,wn]),o["\u0275mpd"](1073742336,Nn.a,Nn.a,[]),o["\u0275mpd"](1073742336,C.CommonModule,C.CommonModule,[]),o["\u0275mpd"](1073742336,Rn.a,Rn.a,[]),o["\u0275mpd"](1073742336,S.C,S.C,[]),o["\u0275mpd"](1073742336,S.m,S.m,[]),o["\u0275mpd"](1073742336,jn,jn,[]),o["\u0275mpd"](1073742336,kn,kn,[]),o["\u0275mpd"](1073742336,S.y,S.y,[]),o["\u0275mpd"](1073742336,U.e,U.e,[]),o["\u0275mpd"](1073742336,U.d,U.d,[]),o["\u0275mpd"](1073742336,Fn.a,Fn.a,[]),o["\u0275mpd"](1073742336,G.o,G.o,[[2,G.u],[2,G.l]]),o["\u0275mpd"](1073742336,Tn.a,Tn.a,[]),o["\u0275mpd"](1073742336,on.a,on.a,[]),o["\u0275mpd"](1073742336,An.a,An.a,[]),o["\u0275mpd"](1073742336,En.a,En.a,[]),o["\u0275mpd"](1073742336,Ln.a,Ln.a,[]),o["\u0275mpd"](1073742336,Vn.a,Vn.a,[]),o["\u0275mpd"](1073742336,Un.a,Un.a,[]),o["\u0275mpd"](1073742336,qn.a,qn.a,[]),o["\u0275mpd"](1073742336,cn.c,cn.c,[]),o["\u0275mpd"](1073742336,Bn.b,Bn.b,[]),o["\u0275mpd"](1073742336,Dn.b,Dn.b,[]),o["\u0275mpd"](1073742336,Xn.a,Xn.a,[]),o["\u0275mpd"](1073742336,r,r,[]),o["\u0275mpd"](256,U.n,"XSRF-TOKEN",[]),o["\u0275mpd"](256,U.o,"X-XSRF-TOKEN",[])])})}}]);
//# sourceMappingURL=12.53e65401905f3f00b0a6.js.map